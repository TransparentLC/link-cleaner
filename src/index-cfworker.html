<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta name="author" content="TransparentLC">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simpledotcss@2/simple.min.css">
    <link rel="icon" href="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
    <title>Link Cleaner | 网站链接清洗器</title>
</head>
<body>
    <header>
        <nav>
            <a href="https://github.com/TransparentLC/link-cleaner">
                <svg style="width:1rem;height:1.3rem;margin-right:.3rem;vertical-align:sub;stroke-width:0;stroke:currentColor;fill:currentColor" viewBox="0 0 32 32">
                    <path
                        d="M16 0.395c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z">
                    </path>
                </svg>Github
            </a>
        </nav>

        <h1>Link Cleaner</h1>
        <p>对付“超不链接”和跟踪/推广参数的网站链接清洗器</p>
    </header>
    <main>
        <p style="display:flex">
            <input id="text" style="flex-grow:1;margin:.5rem 0" type="text" placeholder="需要清洗的链接">
            <button id="clean">清洗</button>
            <button id="copy">复制</button>
        </p>
        <blockquote style="font-style:normal">
            <p id="title" style="margin:.5rem 0">TransparentLC/link-cleaner: 网站链接清洗器</p>
            <p style="margin:.5rem 0"><a id="cleaned" href="https://github.com/TransparentLC/link-cleaner" target="_blank" rel="noopener noreferrer">https://github.com/TransparentLC/link-cleaner</a></p>
        </blockquote>
        <hr>
        <h3>关于项目</h3>
        <p>这个项目受油猴脚本<a href="https://greasyfork.org/zh-CN/scripts/412612" target="_blank" rel="noopener noreferrer">“Open the F**king URL Right Now”</a>和<a href="https://greasyfork.org/zh-CN/scripts/416338" target="_blank" rel="noopener noreferrer">“redirect 外链跳转”</a>的启发，作用是对以下类型的超链接进行“净化”处理：</p>
        <ul>
            <li>阻碍用户直达目标网页的“超不链接”
                <ul>
                    <li>清洗前：<code>https://link.zhihu.com/?target=https%3A//example.com</code></li>
                    <li>清洗后：<code>https://example.com</code></li>
                </ul>
            </li>
            <li>带有跟踪参数的链接
                <ul>
                    <li>清洗前：<code>https://b23.tv/r15682i</code>（此链接将跳转到
                        <code>https://www.bilibili.com/video/BV16u411Z7Pj?p=1&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=439a9ce3-414e-4606-98d6-a0098e305a46&amp;share_source=COPY&amp;share_tag=s_i&amp;timestamp=1652639989&amp;unique_k=r15682i</code>）
                    </li>
                    <li>清洗后：<code>https://www.bilibili.com/video/av506045471</code></li>
                </ul>
            </li>
            <li>隐藏推广、返利参数的链接
                <ul>
                    <li>清洗前：<code>https://www.vultr.com/?ref=114514</code></li>
                    <li>清洗后：<code>https://www.vultr.com/</code></li>
                </ul>
            </li>
        </ul>
        <h3>使用方式</h3>
        <p>提供油猴脚本和 Cloudflare Workers 两种使用方式。</p>
        <h4>油猴脚本</h4>
        <p><a href="https://i.akarin.dev/link-cleaner.user.js" rel="noreferrer noopener" target="_blank">https://i.akarin.dev/link-cleaner.user.js</a></p>
        <p>脚本会对网页上所有 <code>&lt;a&gt;</code> 标签指向的链接进行清洗。如果你当前打开的页面的 URL 本身可以被清洗，则脚本也会自动跳转到清洗过的 URL。</p>
        <p>此外，也可以在菜单中选择手动清洗网页上的所有链接（用于动态添加 <code>&lt;a&gt;</code> 标签的情况）。</p>
        <h4>Cloudflare Workers</h4>
        <p><code>https://i.akarin.dev/link-cleaner/?url=https://example.com</code></p>
        <p><code>https://i.akarin.dev/link-cleaner/?title&amp;url=https://example.com</code></p>
        <p>使用 <code>url</code> 参数输入链接，将返回清洗后的结果。</p>
        <p>如果需要获取这个链接对应的网页的标题（<code>&lt;title&gt;</code>），可以在请求时添加 <code>title</code> 参数。</p>
        <hr>
        <footer style="text-align:center;margin:1rem 0">
            <small>© 2022 <a href="https://akarin.dev" rel="noreferrer noopener" target="_blank">✨小透明・宸✨</a></small>
        </footer>
    </main>

    <script>
        (() => {
            const getElementById = e => document.getElementById(e);
            const $text = getElementById('text');
            const $clean = getElementById('clean');
            const $copy = getElementById('copy');
            const $title = getElementById('title');
            const $cleaned = getElementById('cleaned');

            $clean.onclick = () => {
                if (!$text.value) return;
                $clean.setAttribute('disabled', '');
                const u = new URL(location.href);
                Array.from(u.searchParams.keys()).forEach(e => u.searchParams.delete(e));
                u.searchParams.set('title', '');
                u.searchParams.set('url', $text.value);
                fetch(u)
                    .then(r => {
                        if (r.status >= 400) throw new Error(`${r.status} ${r.statusText}`);
                        return r.text();
                    })
                    .then(r => {
                        const [title, url] = r.split('\n');
                        $title.innerText = title;
                        $cleaned.href = $cleaned.innerText = url;
                    })
                    .catch(err => {
                        $title.innerText = err.toString();
                        $cleaned.href = $cleaned.innerText = '';
                    })
                    .finally(() => $clean.removeAttribute('disabled'));
            };

            $copy.onclick = () => navigator.clipboard.writeText(`${$title.innerText}\n${$cleaned.innerText}`).then(() => alert('已复制！'));
        })()
    </script>
</body>
</html>